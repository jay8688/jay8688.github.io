<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Rolling with Pelican &mdash; Pie Thought On</title>
  <meta name="author" content="Jay">






  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="/favicon.png" rel="icon">

  <link href="/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="/">Pie Thought On</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="/category/machine-learning.html">Machine learning</a>
      </li>
      <li >
        <a href="/category/misc.html">Misc</a>
      </li>
      <li class="active">
        <a href="/category/python.html">Python</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Rolling with Pelican</h1>
    <p class="meta">
<time datetime="2015-10-28T13:12:00-04:00" pubdate>Wed 28 October 2015</time>    </p>
</header>

  <div class="entry-content"><p>Python的用途真是无处不在，包括制作一个github博客。最近读到<a href="http://www.astro.washington.edu/users/vanderplas/">Jake VanderPlas</a>的博文<a href="https://jakevdp.github.io/blog/2013/05/07/migrating-from-octopress-to-pelican/">Migrating from Octopress to Pelican</a>，油然产生了利用Pelican制作一个根正苗红的建立在Python上的博客平台，也在此和基于ruby的Octopress说暂别。
</p>
<p>Pelican还支持ipython notebook格式(ipynb)，能将博文和Python代码笔记完美结合，没有再好了！</p>
<p>创建Pelican博客，我主要参考了<a href="http://nafiulis.me/making-a-static-blog-with-pelican.html">Making a Static Blog with Pelican</a>。在我所看到的讲解构建Pelican博客的技术文档中，个人感觉此文最明了也最有借鉴价值。由于习惯markdown语法，我修改了TEMPLATE变量以及make_entry方法。</p>
<div class="highlight"><pre><span></span><span class="ss">TEMPLATE =</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Title: {title}</span>
<span class="s2">Date: {year}-{month}-{day} {hour}:{minute:02d}</span>
<span class="s2">Modified:</span>
<span class="s2">Category:</span>
<span class="s2">Tags:</span>
<span class="s2">Slug: {slug}</span>
<span class="s2">Authors:</span>


<span class="s2">&quot;&quot;&quot;</span>

def make_entry<span class="p">(</span>title<span class="p">):</span>
    <span class="ss">today =</span> datetime<span class="o">.</span>today<span class="p">()</span>
    <span class="ss">slug =</span> title<span class="o">.</span>lower<span class="p">()</span><span class="o">.</span>strip<span class="p">()</span><span class="o">.</span>replace<span class="p">(</span><span class="err">&#39;</span> <span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;-&#39;</span><span class="p">)</span>
    <span class="ss">f_create =</span> <span class="s2">&quot;content/{}_{:0&gt;2}_{:0&gt;2}_{}.md&quot;</span><span class="o">.</span>format<span class="p">(</span>
        today<span class="o">.</span>year<span class="p">,</span> today<span class="o">.</span>month<span class="p">,</span> today<span class="o">.</span>day<span class="p">,</span> slug<span class="p">)</span>
    <span class="ss">t =</span> TEMPLATE<span class="o">.</span>strip<span class="p">()</span><span class="o">.</span>format<span class="p">(</span><span class="ss">title=</span>title<span class="p">,</span>                                
                                <span class="ss">year=</span>today<span class="o">.</span>year<span class="p">,</span>
                                <span class="ss">month=</span>today<span class="o">.</span>month<span class="p">,</span>
                                <span class="ss">day=</span>today<span class="o">.</span>day<span class="p">,</span>
                                <span class="ss">hour=</span>today<span class="o">.</span>hour<span class="p">,</span>
                                <span class="ss">minute=</span>today<span class="o">.</span>minute<span class="p">,</span>
                                <span class="ss">slug=</span>slug<span class="p">)</span>
    <span class="k">with</span> open<span class="p">(</span>f_create<span class="p">,</span> <span class="err">&#39;</span>w&#39;<span class="p">)</span> as w<span class="p">:</span>
        w<span class="o">.</span>write<span class="p">(</span>t<span class="p">)</span>
    print<span class="p">(</span><span class="s2">&quot;File created -&gt; &quot;</span> <span class="o">+</span> f_create<span class="p">)</span>
</pre></div>


<p>运行Fabric的fab命令如下，即会在content目录下生成一篇符合markdown语法抬头的*.md文件。</p>
<div class="highlight"><pre><span></span>$ fab make_entry:<span class="s2">&quot;New Post&quot;</span>
</pre></div>


<h4>Preview Content</h4>
<p>安装livereload，用Fabric自动化生成网页文件。配置完成后只要在本机运行</p>
<div class="highlight"><pre><span></span>$ fab live_build
</pre></div>


<p>如果博文源文件有修改，livereload会在网页浏览器内实时显示更新的内容。</p>
<h4>Using Plugins</h4>
<p>还没有看明白，但今后为了博文支持ipynb格式，plugin的使用是必须的。</p>
<h4>Hosting on Github Pages</h4>
<p>ghp-import可以很轻松的把指定文件夹里的内容import到gh-pages branch。运行如下命令</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">ghp</span><span class="o">-</span><span class="kn">import</span> <span class="nn">output</span>
<span class="err">$</span> <span class="n">git</span> <span class="n">push</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">jay8688</span><span class="o">/</span><span class="n">jay8688</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">git</span> <span class="n">gh</span><span class="o">-</span><span class="n">pages</span><span class="p">:</span><span class="n">master</span>
</pre></div>


<p>output文件夹下的内容就同步到jay8688.github.io repository的master branch。</p>
<p>更好的方法是用fabric automate这两步。在fabfile.py底部添加方法</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">github</span><span class="p">(</span><span class="n">publish_drafts</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span> <span class="c1"># 2</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># 3</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;output/drafts&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">publish_drafts</span><span class="p">:</span>
                <span class="n">local</span><span class="p">(</span><span class="s1">&#39;rm -rf output/drafts&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">local</span><span class="p">(</span><span class="s1">&#39;ghp-import output&#39;</span><span class="p">)</span>  <span class="c1"># 4</span>
    <span class="n">local</span><span class="p">(</span><span class="s1">&#39;git push &#39;</span>
          <span class="s1">&#39;https://github.com/jay8688/jay8688.github.io.git &#39;</span>
          <span class="s1">&#39;gh-pages:master&#39;</span><span class="p">)</span> <span class="c1"># 5</span>
    <span class="n">local</span><span class="p">(</span><span class="s1">&#39;rm -rf output&#39;</span><span class="p">)</span>  <span class="c1"># 6</span>
</pre></div>


<p>Publish到github，只需轻松敲打</p>
<div class="highlight"><pre><span></span>$ fab github
</pre></div>


<p>There would be a problem if the gh-pages branch in your current repo is not in-sync with remote master branch. In this circumstance, the approach above could fail to do the push. You would need to delete your current gh-pages branch and fetch a new one from remote. The publication to github will work then because branch conflicts are effectively resolved in this way.</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">git</span> <span class="n">branch</span> <span class="o">-</span><span class="n">D</span> <span class="n">gh</span><span class="o">-</span><span class="n">pages</span>
<span class="err">$</span> <span class="n">git</span> <span class="n">fetch</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jay8688</span><span class="o">/</span><span class="n">jay8688</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span> <span class="n">master</span><span class="p">:</span><span class="n">gh</span><span class="o">-</span><span class="n">pages</span>
<span class="err">$</span> <span class="n">ghp</span><span class="o">-</span><span class="kn">import</span> <span class="nn">output</span>
<span class="err">$</span> <span class="n">git</span> <span class="n">push</span> <span class="o">-</span><span class="n">u</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jay8688</span><span class="o">/</span><span class="n">jay8688</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">git</span> <span class="n">gh</span><span class="o">-</span><span class="n">pages</span><span class="p">:</span><span class="n">master</span>
</pre></div></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Jay
    </span>
  </span>
<time datetime="2015-10-28T13:12:00-04:00" pubdate>Wed 28 October 2015</time>  <span class="categories">
    <a class='category' href='/category/python.html'>Python</a>
  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="/data-visualization-with-python.html">Data Visualization with Python</a>
      </li>
      <li class="post">
          <a href="/neural-network-for-object-detection.html">Neural Network for Object Detection</a>
      </li>
      <li class="post">
          <a href="/rolling-with-pelican.html">Rolling with Pelican</a>
      </li>
      <li class="post">
          <a href="/rolling-with-python.html">Rolling with Python</a>
      </li>
      <li class="post">
          <a href="/rolling-with-git.html">Rolling with Git</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="/category/machine-learning.html">machine learning</a></li>
        <li><a href="/category/misc.html">misc</a></li>
        <li><a href="/category/python.html">Python</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
  </section>


    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="#" target="_blank">You can add links in your config file</a></li>
            <li><a href="#" target="_blank">Another social link</a></li>
        </ul>
    </section>
    <section>
        <h1>Blogroll</h1>
        <ul>
            <li><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
            <li><a href="http://python.org/" target="_blank">Python.org</a></li>
            <li><a href="#" target="_blank">You can modify those links in your config file</a></li>
        </ul>
    </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2015&ndash;2016  Jay &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="/theme/js/modernizr-2.0.js"></script>
  <script src="/theme/js/ender.js"></script>
  <script src="/theme/js/octopress.js" type="text/javascript"></script>
</body>
</html>